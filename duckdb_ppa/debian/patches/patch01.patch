diff --git a/CMakeLists.txt b/CMakeLists.txt
index ea74d55f86..e98585e46e 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -292,7 +292,7 @@ endif()
 
 string(REGEX MATCH ".*dev.*" DUCKDB_EXTENSION_FOLDER_IS_VERSION "${DUCKDB_VERSION}")
 
-if(DUCKDB_EXTENSION_FOLDER_IS_VERSION AND DEFINED GIT_COMMIT_HASH)
+if(DUCKDB_EXTENSION_FOLDER_IS_VERSION AND NOT GIT_COMMIT_HASH STREQUAL "")
   set(DUCKDB_NORMALIZED_VERSION "${GIT_COMMIT_HASH}")
 else()
   set(DUCKDB_NORMALIZED_VERSION "${DUCKDB_VERSION}")
@@ -304,6 +304,10 @@ else()
   set(EXTENSION_POSTFIX "duckdb_extension")
 endif()
 
+if (NOT DEFINED DUCKDB_NORMALIZED_VERSION)
+  message(FATAL_ERROR "DUCKDB_NORMALIZED_VERSION not defined")
+endif()
+
 message(STATUS "git hash ${GIT_COMMIT_HASH}, version ${DUCKDB_VERSION}, extension folder ${DUCKDB_NORMALIZED_VERSION}")
 
 option(AMALGAMATION_BUILD
